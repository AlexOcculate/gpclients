<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN" "http://www.w3.org/MarkUp/Wilbur/HTML32.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    <meta name="GENERATOR" content="Quadralay WebWorks Publisher 2003 for FrameMaker 8.6.6587.0">
    <meta name="TEMPLATEBASE" content="Simple HTML">
    <meta name="LASTUPDATED" content="02/17/09 17:21:46">
    <title>COPY</title>
  </head>

  <body link="#99cc33" vlink="#666699" text="#000000" alink="#FFCC66" bgcolor="#FFFFFF">

    <table width="250" border="0" align="right" cellpadding="0" cellspacing="0">
      <tr> 
        <td>
<strong><font color="#000000" size="1" face="Arial, Helvetica, sans-serif">Greenplum Database 3.3 SQL Reference</font></strong></td>
      </tr>
	  <tr> 
        <td>
          <p><font size="1" face="Arial, Helvetica, sans-serif">Last Updated: February 17, 2009</font></p>
        </td>
      </tr>
	  <tr> 
        <td>
<a href="COMMIT.html"><img src="images/sprev.gif" border="0" alt="Previous"></a><a href="CREATE_AGGREGATE.html"><img src="images/snext.gif" border="0" alt="Next"></a><a href="IX.html"><img src="images/sindex.gif" border="0" alt="Index"></a>
        </td>
      </tr>
	  
    </table>

    <img src="images/GreenplumLogo.jpg" alt="Greenplum" width="212" height="58">
    <hr color="#99CC33" align="left">

    <br>
<a name="wp20941"> </a><h2><font color="#8CC63F" face="Arial, Verdana, Helvetica, sans-serif" size="6"><b>
COPY
</b></font></h2>
<hr color="#99cc33" align="left">
<a name="wp133181"> </a><div><font color="#000000" face="Arial, Verdana, Helvetica, sans-serif" size="2">
Copies data between a file and a table.
</font></div>
<a name="wp132855"> </a><h3><font color="#8CC63F" face="Arial, Verdana, Helvetica, sans-serif" size="5"><b>
Synopsis
</b></font></h3>
<p><font color="Black" face="Courier New, Courier, mono" size="2">COPY <code><font face="Courier New, Courier, mono" size="2"><i>table</i></font></code> [(<code><font face="Courier New, Courier, mono" size="2"><i>column</i></font></code> [, ...])] FROM {&#39;<code><font face="Courier New, Courier, mono" size="2"><i>file</i></font></code>&#39; | STDIN}</font></p><a name="wp137713"> </a>
<pre><font color="Black" face="Courier New, Courier, mono" size="2">&#160;&#160;&#160;&#160;&#160;[ [WITH] </font><a name="wp139544"> </a>
<font color="Black" face="Courier New, Courier, mono" size="2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;[BINARY]</font><a name="wp139545"> </a>
<font color="Black" face="Courier New, Courier, mono" size="2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;[OIDS]</font><a name="wp139546"> </a>
<font color="Black" face="Courier New, Courier, mono" size="2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;[DELIMITER [ AS ] &#39;<code><font face="Courier New, Courier, mono" size="2"><i>delimiter</i></font></code>&#39;]</font><a name="wp139547"> </a>
<font color="Black" face="Courier New, Courier, mono" size="2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;[NULL [ AS ] &#39;<code><font face="Courier New, Courier, mono" size="2"><i>null string</i></font></code>&#39;]</font><a name="wp139548"> </a>
<font color="Black" face="Courier New, Courier, mono" size="2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;[ESCAPE [ AS ] &#39;<code><font face="Courier New, Courier, mono" size="2"><i>escape</i></font></code>&#39; | &#39;OFF&#39;]</font><a name="wp139549"> </a>
<font color="Black" face="Courier New, Courier, mono" size="2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;[CSV [HEADER] [QUOTE [ AS ] &#39;<code><font face="Courier New, Courier, mono" size="2"><i>quote</i></font></code>&#39;] </font><a name="wp139550"> </a>
<font color="Black" face="Courier New, Courier, mono" size="2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;[FORCE NOT NULL <code><font face="Courier New, Courier, mono" size="2"><i>column</i></font></code> [, ...]]</font><a name="wp139551"> </a>
<font color="Black" face="Courier New, Courier, mono" size="2">&#160;&#160;&#160;&#160;&#160;[ [LOG ERRORS INTO <code><font face="Courier New, Courier, mono" size="2"><i>error_table</i></font></code>] [KEEP] </font><a name="wp139863"> </a>
<font color="Black" face="Courier New, Courier, mono" size="2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;SEGMENT REJECT LIMIT <code><font face="Courier New, Courier, mono" size="2"><i>count</i></font></code> [ROWS | PERCENT] ]</font><a name="wp140164"> </a>
</pre>
<p><font color="Black" face="Courier New, Courier, mono" size="2">COPY {table [(<code><font face="Courier New, Courier, mono" size="2"><i>column</i></font></code> [, ...])] | (<code><font face="Courier New, Courier, mono" size="2"><i>query</i></font></code>)} TO {&#39;<code><font face="Courier New, Courier, mono" size="2"><i>file</i></font></code>&#39; | STDOUT}</font></p><a name="wp137725"> </a>
<pre><font color="Black" face="Courier New, Courier, mono" size="2">&#160;&#160;&#160;&#160;&#160;&#160;[ [WITH] </font><a name="wp139555"> </a>
<font color="Black" face="Courier New, Courier, mono" size="2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;[BINARY]</font><a name="wp139556"> </a>
<font color="Black" face="Courier New, Courier, mono" size="2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;[HEADER]</font><a name="wp139557"> </a>
<font color="Black" face="Courier New, Courier, mono" size="2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;[OIDS]</font><a name="wp139558"> </a>
<font color="Black" face="Courier New, Courier, mono" size="2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;[DELIMITER [ AS ] &#39;delimiter&#39;]</font><a name="wp139559"> </a>
<font color="Black" face="Courier New, Courier, mono" size="2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;[NULL [ AS ] &#39;null string&#39;]</font><a name="wp139560"> </a>
<font color="Black" face="Courier New, Courier, mono" size="2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;[ESCAPE [ AS ] &#39;escape&#39; | &#39;OFF&#39;]</font><a name="wp139561"> </a>
<font color="Black" face="Courier New, Courier, mono" size="2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;[CSV [HEADER] [QUOTE [ AS ] &#39;quote&#39;] </font><a name="wp139563"> </a>
<font color="Black" face="Courier New, Courier, mono" size="2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;[FORCE QUOTE column [, ...]]</font><a name="wp139562"> </a>
</pre>
<a name="wp118843"> </a><h3><font color="#8CC63F" face="Arial, Verdana, Helvetica, sans-serif" size="5"><b>
Description
</b></font></h3>
<a name="wp138023"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
<code><font face="Courier New, Courier, mono" size="2">COPY</font></code> moves data between Greenplum Database tables and standard file-system files. <code><font face="Courier New, Courier, mono" size="2">COPY TO</font></code> copies the contents of a table to a file, while <code><font face="Courier New, Courier, mono" size="2">COPY FROM</font></code> copies data from a file to a table (appending the data to whatever is in the table already). <code><font face="Courier New, Courier, mono" size="2">COPY TO</font></code> can also copy the results of a <code><font face="Courier New, Courier, mono" size="2">SELECT</font></code> query. 
</font></p>
<a name="wp138025"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
If a list of columns is specified, <code><font face="Courier New, Courier, mono" size="2">COPY</font></code> will only copy the data in the specified columns to or from the file. If there are any columns in the table that are not in the column list, <code><font face="Courier New, Courier, mono" size="2">COPY FROM</font></code> will insert the default values for those columns. 
</font></p>
<a name="wp138451"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
<code><font face="Courier New, Courier, mono" size="2">COPY</font></code> with a file name instructs the Greenplum Database master host to directly read from or write to a file. The file must be accessible to the master host and the name must be specified from the viewpoint of the master host. When <code><font face="Courier New, Courier, mono" size="2">STDIN</font></code> or <code><font face="Courier New, Courier, mono" size="2">STDOUT</font></code> is specified, data is transmitted via the connection between the client and the master.
</font></p>
<a name="wp139879"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
If <code><font face="Courier New, Courier, mono" size="2">SEGMENT REJECT LIMIT</font></code> is used, then a <code><font face="Courier New, Courier, mono" size="2">COPY FROM</font></code> operation will operate in single row error isolation mode. In this release, single row error isolation mode only applies to rows in the input file with format errors - for example, extra or missing attributes, attributes of a wrong data type, or invalid client encoding sequences. Constraint errors such as violation of a <code><font face="Courier New, Courier, mono" size="2">NOT NULL</font></code>, <code><font face="Courier New, Courier, mono" size="2">CHECK</font></code>, or <code><font face="Courier New, Courier, mono" size="2">UNIQUE</font></code> constraint will still be handled in `all-or-nothing&#39; input mode. The user can specify the number of error rows acceptable (on a per-segment basis), after which the entire <code><font face="Courier New, Courier, mono" size="2">COPY FROM</font></code> operation will be aborted and no rows will be loaded. Note that the count of error rows is per-segment, not per entire load operation. If the per-segment reject limit is not reached, then all rows not containing an error will be loaded. If the limit is not reached, all good rows will be loaded and any error rows discarded. If you would like to keep error rows for further examination, you can optionally declare an error table using the <code><font face="Courier New, Courier, mono" size="2">LOG ERRORS INTO</font></code> clause. Any rows containing a format error would then be logged to the specified error table.
</font></p>
<a name="wp139843"> </a><h4><font color="#8CC63F" face="Arial, Verdana, Helvetica, sans-serif" size="4"><b>
Outputs
</b></font></h4>
<a name="wp138457"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
On successful completion, a <code><font face="Courier New, Courier, mono" size="2">COPY</font></code> command returns a command tag of the form, where <code><font face="Courier New, Courier, mono" size="2"><i>count</i></font></code> is the number of rows copied:
</font></p>
<pre><font color="Black" face="Courier New, Courier, mono" size="2">COPY <code><font face="Courier New, Courier, mono" size="2"><i>count</i></font></code></font><a name="wp138459"> </a>
</pre>
<a name="wp140104"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
If running a <code><font face="Courier New, Courier, mono" size="2">COPY FROM</font></code> command in single row error isolation mode, the following notice message will be returned if any rows were not loaded due to format errors, where <code><font face="Courier New, Courier, mono" size="2"><i>count</i></font></code> is the number of rows rejected:
</font></p>
<pre><font color="Black" face="Courier New, Courier, mono" size="2">NOTICE: Rejected <code><font face="Courier New, Courier, mono" size="2"><i>count</i></font></code> badly formatted rows.</font><a name="wp140112"> </a>
</pre>
<a name="wp138453"> </a><h3><font color="#8CC63F" face="Arial, Verdana, Helvetica, sans-serif" size="5"><b>
Parameters
</b></font></h3>
<a name="wp138111"> </a><h6><font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b>
<font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b><i>table</i></b></font>
</b></font></h6>
<a name="wp138112"> </a><div><font color="#000000" face="Arial, Verdana, Helvetica, sans-serif" size="2">
The name (optionally schema-qualified) of an existing table. 
</font></div>
<a name="wp138114"> </a><h6><font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b>
<font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b><i>column</i></b></font>
</b></font></h6>
<a name="wp138115"> </a><div><font color="#000000" face="Arial, Verdana, Helvetica, sans-serif" size="2">
An optional list of columns to be copied. If no column list is specified, all columns of the table will be copied. 
</font></div>
<a name="wp138117"> </a><h6><font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b>
<font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b><i>query</i></b></font>
</b></font></h6>
<a name="wp138118"> </a><div><font color="#000000" face="Arial, Verdana, Helvetica, sans-serif" size="2">
A <code><font face="Courier New, Courier, mono" size="2">SELECT</font></code> or <code><font face="Courier New, Courier, mono" size="2">VALUES</font></code> command whose results are to be copied. Note that parentheses are required around the query. 
</font></div>
<a name="wp138120"> </a><h6><font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b>
<font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b><i>file</i></b></font>
</b></font></h6>
<a name="wp138121"> </a><div><font color="#000000" face="Arial, Verdana, Helvetica, sans-serif" size="2">
The absolute path name of the input or output file.
</font></div>
<a name="wp138123"> </a><h6><font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b>
STDIN
</b></font></h6>
<a name="wp138124"> </a><div><font color="#000000" face="Arial, Verdana, Helvetica, sans-serif" size="2">
Specifies that input comes from the client application.
</font></div>
<a name="wp138126"> </a><h6><font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b>
STDOUT
</b></font></h6>
<a name="wp138127"> </a><div><font color="#000000" face="Arial, Verdana, Helvetica, sans-serif" size="2">
Specifies that output goes to the client application. 
</font></div>
<a name="wp138129"> </a><h6><font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b>
BINARY
</b></font></h6>
<a name="wp138130"> </a><div><font color="#000000" face="Arial, Verdana, Helvetica, sans-serif" size="2">
Causes all data to be stored or read in binary format rather than as text. You cannot specify the <code><font face="Courier New, Courier, mono" size="2">DELIMITER</font></code>, <code><font face="Courier New, Courier, mono" size="2">NULL</font></code>, or <code><font face="Courier New, Courier, mono" size="2">CSV</font></code> options in binary mode. Also, you cannot use single-row error isolation mode (<code><font face="Courier New, Courier, mono" size="2">SEGMENT REJECT LIMIT</font></code> clause) with binary files.
</font></div>
<a name="wp138132"> </a><h6><font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b>
OIDS
</b></font></h6>
<a name="wp138133"> </a><div><font color="#000000" face="Arial, Verdana, Helvetica, sans-serif" size="2">
Specifies copying the OID for each row. (An error is raised if OIDS is specified for a table that does not have OIDs, or in the case of copying a query.) 
</font></div>
<a name="wp138135"> </a><h6><font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b>
<font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b><i>delimiter</i></b></font>
</b></font></h6>
<a name="wp138136"> </a><div><font color="#000000" face="Arial, Verdana, Helvetica, sans-serif" size="2">
The single character that separates columns within each row (line) of the file. The default is a tab character in text mode, a comma in <code><font face="Courier New, Courier, mono" size="2">CSV</font></code> mode. 
</font></div>
<a name="wp138138"> </a><h6><font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b>
<font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b><i>null string</i></b></font>
</b></font></h6>
<a name="wp138139"> </a><div><font color="#000000" face="Arial, Verdana, Helvetica, sans-serif" size="2">
The string that represents a null value. The default is <code><font face="Courier New, Courier, mono" size="2">\N</font></code> (backslash-N) in text mode, and a empty value with no quotes in <code><font face="Courier New, Courier, mono" size="2">CSV</font></code> mode. You might prefer an empty string even in text mode for cases where you don&#39;t want to distinguish nulls from empty strings. When using <code><font face="Courier New, Courier, mono" size="2">COPY FROM</font></code>, any data item that matches this string will be stored as a null value, so you should make sure that you use the same string as you used with <code><font face="Courier New, Courier, mono" size="2">COPY TO</font></code>. 
</font></div>
<a name="wp138344"> </a><h6><font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b>
<font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b><i>escape</i></b></font>
</b></font></h6>
<a name="wp138342"> </a><div><font color="#000000" face="Arial, Verdana, Helvetica, sans-serif" size="2">
Specifies the single character that is used for C escape sequences (such as <code><font face="Courier New, Courier, mono" size="2">\n</font></code>,<code><font face="Courier New, Courier, mono" size="2">\t</font></code>,<code><font face="Courier New, Courier, mono" size="2">\100</font></code>, and so on) and for quoting data characters that might otherwise be taken as row or column delimiters. Make sure to choose an escape character that is not used anywhere in your actual column data. The default escape character is a <code><font face="Courier New, Courier, mono" size="2">\</font></code> (backslash), however it is possible to specify any other character to represent an escape. It is also possible to disable escaping by specifying the value <code><font face="Courier New, Courier, mono" size="2">OFF</font></code> as the escape value. This is very useful for data such as web log data that has many embedded backslashes that are not intended to be escapes.
</font></div>
<a name="wp138143"> </a><h6><font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b>
CSV
</b></font></h6>
<a name="wp138144"> </a><div><font color="#000000" face="Arial, Verdana, Helvetica, sans-serif" size="2">
Selects Comma Separated Value (CSV) mode. 
</font></div>
<a name="wp138146"> </a><h6><font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b>
HEADER
</b></font></h6>
<a name="wp138147"> </a><div><font color="#000000" face="Arial, Verdana, Helvetica, sans-serif" size="2">
Specifies that a CSV file contains a header line with the names of each column in the file. On output, the first line contains the column names from the table, and on input, the first line is ignored. 
</font></div>
<a name="wp138149"> </a><h6><font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b>
<font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b><i>quote</i></b></font>
</b></font></h6>
<a name="wp138150"> </a><div><font color="#000000" face="Arial, Verdana, Helvetica, sans-serif" size="2">
Specifies the quotation character in CSV mode. The default is double-quote. 
</font></div>
<a name="wp138155"> </a><h6><font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b>
FORCE QUOTE
</b></font></h6>
<a name="wp138156"> </a><div><font color="#000000" face="Arial, Verdana, Helvetica, sans-serif" size="2">
In <code><font face="Courier New, Courier, mono" size="2">CSV COPY TO</font></code> mode, forces quoting to be used for all non-<code><font face="Courier New, Courier, mono" size="2">NULL</font></code> values in each specified column. <code><font face="Courier New, Courier, mono" size="2">NULL</font></code> output is never quoted.
</font></div>
<a name="wp138158"> </a><h6><font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b>
FORCE NOT NULL
</b></font></h6>
<a name="wp138159"> </a><div><font color="#000000" face="Arial, Verdana, Helvetica, sans-serif" size="2">
In <code><font face="Courier New, Courier, mono" size="2">CSV COPY FROM</font></code> mode, process each specified column as though it were quoted and hence not a <code><font face="Courier New, Courier, mono" size="2">NULL</font></code> value. For the default null string in <code><font face="Courier New, Courier, mono" size="2">CSV</font></code> mode (<code><font face="Courier New, Courier, mono" size="2">&#39;&#39;</font></code>), this causes missing values to be input as zero-length strings.
</font></div>
<a name="wp139922"> </a><h6><font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b>
LOG ERRORS INTO <font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b><i>error_table</i></b></font> [KEEP]
</b></font></h6>
<a name="wp140337"> </a><div><font color="#000000" face="Arial, Verdana, Helvetica, sans-serif" size="2">
This is an optional clause that may precede a <code><font face="Courier New, Courier, mono" size="2">SEGMENT REJECT LIMIT</font></code> clause. It specifies an error table where rows with formatting errors will be logged when running in single row error isolation mode. You can then examine this error table to see error rows that were not loaded (if any). If the <code><font face="Courier New, Courier, mono" size="2"><i>error_table</i></font></code> specified already exists, it will be used. If it does not exist, it will be automatically generated. If the command auto-generates the error table and no errors are produced, the default is to drop the error table after the operation completes unless <code><font face="Courier New, Courier, mono" size="2">KEEP</font></code> is specified. If the table is auto-generated and the error limit is exceeded, the entire transaction is rolled back and no error data is saved. If you want the error table to persist in this case, create the error table prior to running the <code><font face="Courier New, Courier, mono" size="2">COPY</font></code>. An error table is defined as follows:
</font></div>
<a name="wp140338"> </a><div><font color="#000000" face="Arial, Verdana, Helvetica, sans-serif" size="2">
CREATE TABLE <code><font face="Courier New, Courier, mono" size="2"><i>error_table_name</i></font></code> ( cmdtime timestamptz, relname text, filename text, linenum int, bytenum int, errmsg text, rawdata text, rawbytes bytea ) <br>DISTRIBUTED RANDOMLY;
</font></div>
<a name="wp139924"> </a><h6><font color="#E5B53A" face="Arial, Verdana, Helvetica, sans-serif" size="2"><b>
SEGMENT REJECT LIMIT <code><font face="Courier New, Courier, mono" size="2"><i>count</i></font></code> [ROWS | PERCENT]
</b></font></h6>
<a name="wp140422"> </a><div><font color="#000000" face="Arial, Verdana, Helvetica, sans-serif" size="2">
Runs a <code><font face="Courier New, Courier, mono" size="2">COPY FROM</font></code> operation in single row error isolation mode. If the input rows have format errors they will be discarded provided that the reject limit count is not reached on any Greenplum segment instance during the load operation. The reject limit count can be specified as number of rows (the default) or percentage of total rows (1-99). If <code><font face="Courier New, Courier, mono" size="2">PERCENT</font></code> is used, the percentage of rows per segment is calculated based on the parameter <code><font face="Courier New, Courier, mono" size="2">gp_reject_percent_threshold</font></code> (default is 300 rows). Constraint errors such as violation of a <code><font face="Courier New, Courier, mono" size="2">NOT NULL</font></code>, <code><font face="Courier New, Courier, mono" size="2">CHECK</font></code>, or <code><font face="Courier New, Courier, mono" size="2">UNIQUE</font></code> constraint will still be handled in `all-or-nothing&#39; input mode. If the limit is not reached, all good rows will be loaded and any error rows discarded.
</font></div>
<a name="wp139173"> </a><h3><font color="#8CC63F" face="Arial, Verdana, Helvetica, sans-serif" size="5"><b>
Notes
</b></font></h3>
<a name="wp139174"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
<code><font face="Courier New, Courier, mono" size="2">COPY</font></code> can only be used with tables, not with views. However, you can write <code><font face="Courier New, Courier, mono" size="2">COPY (SELECT * FROM viewname) TO</font></code> .... 
</font></p>
<a name="wp139175"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
The <code><font face="Courier New, Courier, mono" size="2">BINARY</font></code> key word causes all data to be stored/read as binary format rather than as text. It is somewhat faster than the normal text mode, but a binary-format file is less portable across machine architectures and Greenplum Database versions. Also, you cannot run <code><font face="Courier New, Courier, mono" size="2">COPY FROM</font></code> in single row error isolation mode if the data is in binary format.
</font></p>
<a name="wp139177"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
You must have <code><font face="Courier New, Courier, mono" size="2">SELECT</font></code> privilege on the table whose values are read by <code><font face="Courier New, Courier, mono" size="2">COPY TO</font></code>, and insert privilege on the table into which values are inserted by <code><font face="Courier New, Courier, mono" size="2">COPY FROM</font></code>. 
</font></p>
<a name="wp139179"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
Files named in a <code><font face="Courier New, Courier, mono" size="2">COPY</font></code> command are read or written directly by the database server, not by the client application. Therefore, they must reside on or be accessible to the Greenplum Database master host machine, not the client. They must be accessible to and readable or writable by the Greenplum Database administrative user (the user ID the server runs as), not the client. <code><font face="Courier New, Courier, mono" size="2">COPY</font></code> naming a file is only allowed to database superusers, since it allows reading or writing any file that the server has privileges to access.
</font></p>
<a name="wp139185"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
<code><font face="Courier New, Courier, mono" size="2">COPY FROM</font></code> will invoke any triggers and check constraints on the destination table. However, it will not invoke rewrite rules. Note that in this release, violations of constraints are not evaluated for single row error isolation mode.
</font></p>
<a name="wp139187"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
<code><font face="Courier New, Courier, mono" size="2">COPY</font></code> input and output is affected by <code><font face="Courier New, Courier, mono" size="2">DateStyle</font></code>. To ensure portability to other Greenplum Database installations that might use non-default <code><font face="Courier New, Courier, mono" size="2">DateStyle</font></code> settings, <code><font face="Courier New, Courier, mono" size="2">DateStyle</font></code> should be set to ISO before using <code><font face="Courier New, Courier, mono" size="2">COPY TO</font></code>.
</font></p>
<a name="wp139189"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
By default, <code><font face="Courier New, Courier, mono" size="2">COPY</font></code> stops operation at the first error. This should not lead to problems in the event of a <code><font face="Courier New, Courier, mono" size="2">COPY TO</font></code>, but the target table will already have received earlier rows in a <code><font face="Courier New, Courier, mono" size="2">COPY FROM</font></code>. These rows will not be visible or accessible, but they still occupy disk space. This may amount to a considerable amount of wasted disk space if the failure happened well into a large <code><font face="Courier New, Courier, mono" size="2">COPY FROM</font></code> operation. You may wish to invoke <code><font face="Courier New, Courier, mono" size="2">VACUUM</font></code> to recover the wasted space. Another option would be to use single row error isolation mode to filter out error rows while still loading good rows. 
</font></p>
<a name="wp140256"> </a><h3><font color="#8CC63F" face="Arial, Verdana, Helvetica, sans-serif" size="5"><b>
File Formats
</b></font></h3>
<a name="wp138566"> </a><h4><font color="#8CC63F" face="Arial, Verdana, Helvetica, sans-serif" size="4"><b>
Text Format
</b></font></h4>
<a name="wp138578"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
When <code><font face="Courier New, Courier, mono" size="2">COPY</font></code> is used without the <code><font face="Courier New, Courier, mono" size="2">BINARY</font></code> or <code><font face="Courier New, Courier, mono" size="2">CSV</font></code> options, the data read or written is a text file with one line per table row. Columns in a row are separated by the <code><font face="Courier New, Courier, mono" size="2"><i>delimiter</i></font></code> character (tab by default). The column values themselves are strings generated by the output function, or acceptable to the input function, of each attribute&#39;s data type. The specified null string is used in place of columns that are null. <code><font face="Courier New, Courier, mono" size="2">COPY FROM</font></code> will raise an error if any line of the input file contains more or fewer columns than are expected. If <code><font face="Courier New, Courier, mono" size="2">OIDS</font></code> is specified, the OID is read or written as the first column, preceding the user data columns.
</font></p>
<a name="wp138827"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
The data file has two reserved characters that have special meaning to <code><font face="Courier New, Courier, mono" size="2">COPY</font></code>:
</font></p>
<ul>
<a name="wp138828"> </a><li><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">The designated delimiter character (tab by default), which is used to separate fields in the data file. </font></li>
</ul>

<ul>
<a name="wp138829"> </a><li><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">A Unix-style line feed (<code><font face="Courier New, Courier, mono" size="2">\n</font></code> or <code><font face="Courier New, Courier, mono" size="2">0x0a</font></code>), which is used to designate a new row in the data file. It is strongly recommended that applications generating <code><font face="Courier New, Courier, mono" size="2">COPY</font></code> data convert data line feeds to Unix-style line feeds rather than Microsoft Windows style carriage return line feeds (<code><font face="Courier New, Courier, mono" size="2">\r\n</font></code> or <code><font face="Courier New, Courier, mono" size="2">0x0a 0x0d</font></code>). </font></li>
</ul>

<a name="wp138830"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
If your data contains either of these characters, you must escape the character so <code><font face="Courier New, Courier, mono" size="2">COPY</font></code> treats it as data and not as a field separator or new row.
</font></p>
<a name="wp138834"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
By default, the escape character is a \ (backslash). If you want to use a different escape character, you can do so using the <code><font face="Courier New, Courier, mono" size="2">ESCAPE AS </font></code>clause. Make sure to choose an escape character that is not used anywhere in your data file as an actual data value. If there is no need to escape the data, you can disable escaping by using <code><font face="Courier New, Courier, mono" size="2">ESCAPE &#39;OFF&#39;</font></code>.
</font></p>
<a name="wp138840"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
For example, suppose you have a table with three columns and you want to load the following three fields using COPY. 
</font></p>
<ul>
<a name="wp138844"> </a><li><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">percentage sign = %</font></li>
</ul>

<ul>
<a name="wp138845"> </a><li><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">vertical bar = |</font></li>
</ul>

<ul>
<a name="wp138887"> </a><li><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">backslash = \</font></li>
</ul>

<a name="wp138847"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
Your designated <code><font face="Courier New, Courier, mono" size="2">DELIMITER</font></code> character is <code><font face="Courier New, Courier, mono" size="2">|</font></code> (pipe character), and your designated <code><font face="Courier New, Courier, mono" size="2">ESCAPE</font></code> character is <code><font face="Courier New, Courier, mono" size="2">*</font></code> (asterisk). The formatted row in your data file would look like this:
</font></p>
<p><font color="Black" face="Courier New, Courier, mono" size="2">percentage sign = % | vertical bar = <code><font face="Courier New, Courier, mono" size="2"><b>*|</b></font></code> | backslash = \</font></p><a name="wp138848"> </a>
<a name="wp138849"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
Notice how the pipe character that is part of the data has been escaped using the asterisk character (*). Also notice that we do not need to escape the backslash since we are using an alternative escape character.
</font></p>
<a name="wp138959"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
By default, backslash characters (\) are used in the <code><font face="Courier New, Courier, mono" size="2">COPY</font></code> data to quote data characters that might otherwise be taken as row or column delimiters. In particular, the following characters must be preceded by a backslash (or an alternative escape character) if they appear as part of a column value: backslash itself, newline, carriage return, and the current delimiter character. Alternatively, you can specify a different escape character using the <code><font face="Courier New, Courier, mono" size="2">ESCAPE AS</font></code> clause or by turn escaping <code><font face="Courier New, Courier, mono" size="2">OFF</font></code>, thus allowing for literal backslashes in the data.
</font></p>
<a name="wp139007"> </a><h4><font color="#8CC63F" face="Arial, Verdana, Helvetica, sans-serif" size="4"><b>
CSV Format
</b></font></h4>
<a name="wp139015"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
This format is used for importing and exporting the Comma Separated Value (CSV) file format used by many other programs, such as spreadsheets. Instead of the escaping used by Greenplum Database standard text mode, it produces and recognizes the common CSV escaping mechanism. 
</font></p>
<a name="wp139017"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
The values in each record are separated by the <code><font face="Courier New, Courier, mono" size="2">DELIMITER</font></code> character. If the value contains the delimiter character, the <code><font face="Courier New, Courier, mono" size="2">QUOTE</font></code> character, the <code><font face="Courier New, Courier, mono" size="2">NULL</font></code> string, a carriage return, or line feed character, then the whole value is prefixed and suffixed by the <code><font face="Courier New, Courier, mono" size="2">QUOTE</font></code> character. You can also use <code><font face="Courier New, Courier, mono" size="2">FORCE QUOTE</font></code> to force quotes when outputting non-<code><font face="Courier New, Courier, mono" size="2">NULL</font></code> values in specific columns. 
</font></p>
<a name="wp139019"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
The CSV format has no standard way to distinguish a <code><font face="Courier New, Courier, mono" size="2">NULL</font></code> value from an empty string. Greenplum Database <code><font face="Courier New, Courier, mono" size="2">COPY</font></code> handles this by quoting. A <code><font face="Courier New, Courier, mono" size="2">NULL</font></code> is output as the <code><font face="Courier New, Courier, mono" size="2">NULL</font></code> string and is not quoted, while a data value matching the <code><font face="Courier New, Courier, mono" size="2">NULL</font></code> string is quoted. Therefore, using the default settings, a <code><font face="Courier New, Courier, mono" size="2">NULL</font></code> is written as an unquoted empty string, while an empty string is written with double quotes (&quot;&quot;). Reading values follows similar rules. You can use <code><font face="Courier New, Courier, mono" size="2">FORCE NOT NULL</font></code> to prevent <code><font face="Courier New, Courier, mono" size="2">NULL</font></code> input comparisons for specific columns.
</font></p>
<a name="wp139021"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
Because backslash is not a special character in the <code><font face="Courier New, Courier, mono" size="2">CSV</font></code> format, <code><font face="Courier New, Courier, mono" size="2">\.</font></code>, the end-of-data marker, could also appear as a data value. To avoid any misinterpretation, a<code><font face="Courier New, Courier, mono" size="2"> \.</font></code> data value appearing as a lone entry on a line is automatically quoted on output, and on input, if quoted, is not interpreted as the end-of-data marker. If you are loading a file created by another application that has a single unquoted column and might have a value of <code><font face="Courier New, Courier, mono" size="2">\.</font></code>, you might need to quote that value in the input file.
</font></p>
<a name="wp139023"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
Note: In <code><font face="Courier New, Courier, mono" size="2">CSV</font></code> mode, all characters are significant. A quoted value surrounded by white space, or any characters other than <code><font face="Courier New, Courier, mono" size="2">DELIMITER</font></code>, will include those characters. This can cause errors if you import data from a system that pads CSV lines with white space out to some fixed width. If such a situation arises you might need to preprocess the CSV file to remove the trailing white space, before importing the data into Greenplum Database. 
</font></p>
<a name="wp139025"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
Note: <code><font face="Courier New, Courier, mono" size="2">CSV</font></code> mode will both recognize and produce CSV files with quoted values containing embedded carriage returns and line feeds. Thus the files are not strictly one line per table row like text-mode files. 
</font></p>
<a name="wp139027"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
Note: Many programs produce strange and occasionally perverse CSV files, so the file format is more a convention than a standard. Thus you might encounter some files that cannot be imported using this mechanism, and <code><font face="Courier New, Courier, mono" size="2">COPY</font></code> might produce files that other programs cannot process. 
</font></p>
<a name="wp139012"> </a><h4><font color="#8CC63F" face="Arial, Verdana, Helvetica, sans-serif" size="4"><b>
Binary Format
</b></font></h4>
<a name="wp139296"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
The <code><font face="Courier New, Courier, mono" size="2">BINARY</font></code> format consists of a file header, zero or more tuples containing the row data, and a file trailer. Headers and data are in network byte order. 
</font></p>
<ul>
<a name="wp139298"> </a><li><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">File Header - The file header consists of 15 bytes of fixed fields, followed by a variable-length header extension area. The fixed fields are: </font></li>
</ul>

<ul>
<a name="wp139303"> </a><li><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">Signature - 11-byte sequence PGCOPY\n\377\r\n\0 - note that the zero byte is a required part of the signature. (The signature is designed to allow easy identification of files that have been munged by a non-8-bit-clean transfer. This signature will be changed by end-of-line-translation filters, dropped zero bytes, dropped high bits, or parity changes.) </font></li>
</ul>

<ul>
<a name="wp139306"> </a><li><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">Flags field - 32-bit integer bit mask to denote important aspects of the file format. Bits are numbered from 0 (LSB) to 31 (MSB). Note that this field is stored in network byte order (most significant byte first), as are all the integer fields used in the file format. Bits 16-31 are reserved to denote critical file format issues; a reader should abort if it finds an unexpected bit set in this range. Bits 0-15 are reserved to signal backwards-compatible format issues; a reader should simply ignore any unexpected bits set in this range. Currently only one flag is defined, and the rest must be zero (Bit 16: 1 if data has OIDs, 0 if not).</font></li>
</ul>

<ul>
<a name="wp139315"> </a><li><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">Header extension area length - 32-bit integer, length in bytes of remainder of header, not including self. Currently, this is zero, and the first tuple follows immediately. Future changes to the format might allow additional data to be present in the header. A reader should silently skip over any header extension data it does not know what to do with. The header extension area is envisioned to contain a sequence of self-identifying chunks. The flags field is not intended to tell readers what is in the extension area. Specific design of header extension contents is left for a later release. </font></li>
</ul>

<ul>
<a name="wp139323"> </a><li><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">Tuples - Each tuple begins with a 16-bit integer count of the number of fields in the tuple. (Presently, all tuples in a table will have the same count, but that might not always be true.) Then, repeated for each field in the tuple, there is a 32-bit length word followed by that many bytes of field data. (The length word does not include itself, and can be zero.) As a special case, -1 indicates a NULL field value. No value bytes follow in the NULL case. </font></li>
</ul>

<a name="wp139326"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
There is no alignment padding or any other extra data between fields. 
</font></p>
<a name="wp139328"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
Presently, all data values in a COPY BINARY file are assumed to be in binary format (format code one). It is anticipated that a future extension may add a header field that allows per-column format codes to be specified. 
</font></p>
<a name="wp139332"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
If OIDs are included in the file, the OID field immediately follows the field-count word. It is a normal field except that it&#39;s not included in the field-count. In particular it has a length word - this will allow handling of 4-byte vs. 8-byte OIDs without too much pain, and will allow OIDs to be shown as null if that ever proves desirable. 
</font></p>
<ul>
<a name="wp139334"> </a><li><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">File Trailer - The file trailer consists of a 16-bit integer word containing <code><font face="Courier New, Courier, mono" size="2">-1</font></code>. This is easily distinguished from a tuple&#39;s field-count word. A reader should report an error if a field-count word is neither <code><font face="Courier New, Courier, mono" size="2">-1</font></code> nor the expected number of columns. This provides an extra check against somehow getting out of sync with the data. </font></li>
</ul>

<a name="wp136309"> </a><h3><font color="#8CC63F" face="Arial, Verdana, Helvetica, sans-serif" size="5"><b>
Examples
</b></font></h3>
<a name="wp139487"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
Copy a table to the client using the vertical bar (|) as the field delimiter:
</font></p>
<pre><font color="Black" face="Courier New, Courier, mono" size="2">COPY country TO STDOUT WITH DELIMITER &#39;|&#39;;</font><a name="wp139488"> </a>
</pre>
<a name="wp139489"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
Copy data from a file into the country table:
</font></p>
<pre><font color="Black" face="Courier New, Courier, mono" size="2">COPY country FROM &#39;/home/usr1/sql/country_data&#39;;</font><a name="wp139490"> </a>
</pre>
<a name="wp139518"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
Copy into a file just the countries whose names start with &#39;A&#39;:
</font></p>
<pre><font color="Black" face="Courier New, Courier, mono" size="2">COPY (SELECT * FROM country WHERE country_name LIKE &#39;A%&#39;) TO 
&#39;/home/usr1/sql/a_list_countries.copy&#39;;</font><a name="wp139516"> </a>
</pre>
<a name="wp140051"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
Create an error table called err_sales to use with single row error isolation mode:
</font></p>
<a name="wp140406"> </a><div><font color="#000000" face="Arial, Verdana, Helvetica, sans-serif" size="2">
CREATE TABLE <code><font face="Courier New, Courier, mono" size="2"><i>err_sales</i></font></code> ( cmdtime timestamptz, relname text, filename text, linenum int, bytenum int, errmsg text, rawdata text, rawbytes bytea ) <br>DISTRIBUTED RANDOMLY;
</font></div>
<a name="wp140360"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
Copy data from a file into the sales table using single row error isolation mode:
</font></p>
<pre><font color="Black" face="Courier New, Courier, mono" size="2">COPY sales FROM &#39;/home/usr1/sql/sales_data&#39; LOG ERRORS INTO 
err_sales SEGMENT REJECT LIMIT 10 ROWS;</font><a name="wp140071"> </a>
</pre>
<a name="wp134733"> </a><h3><font color="#8CC63F" face="Arial, Verdana, Helvetica, sans-serif" size="5"><b>
Compatibility
</b></font></h3>
<a name="wp138104"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
There is no <code><font face="Courier New, Courier, mono" size="2">COPY</font></code> statement in the SQL standard. 
</font></p>
<a name="wp139852"> </a><h3><font color="#8CC63F" face="Arial, Verdana, Helvetica, sans-serif" size="5"><b>
See Also
</b></font></h3>
<a name="wp139856"> </a><p><font color="Black" face="Arial, Verdana, Helvetica, sans-serif" size="2">
<a href="CREATE_EXTERNAL_TABLE.html">CREATE EXTERNAL TABLE</a>
</font></p>
    <br>
    <hr color="#99CC33" align="left"> 

    <table width="157" border="0" align="right" cellpadding="0" cellspacing="0">
  <tr valign="top"> 
    <td width="157"  align="left"><p> 
        <font size="1"><font size="1"><font face="Arial, Helvetica, sans-serif">Greenplum Customer Support <br>
		
        1-866-410-6060
</font></font></font><font size="1"><font face="Arial, Helvetica, sans-serif"><br>
<a href="mailto://support@greenplum.com">support@greenplum.com
</a><br>
</font> </font> <font size="1"><a href="http://gpn.greenplum.com"><font face="Arial, Helvetica, sans-serif"> www.gpn.greenplum.com</font></a></font>  <font size="1"></font> <font size="1"></font> <font size="1"><br>
        </font> </p></td>
  </tr>
</table>
	

    


    <table width="250" border="0" cellpadding="0" cellspacing="0">
      <tr> 
        <td>
<a href="COMMIT.html"><img src="images/sprev.gif" border="0" alt="Previous"></a><a href="CREATE_AGGREGATE.html"><img src="images/snext.gif" border="0" alt="Next"></a><a href="IX.html"><img src="images/sindex.gif" border="0" alt="Index"></a>
        </td>
      </tr>
	  <tr> 
        <td>
          <p><strong><font color="#000000" size="1" face="Arial, Helvetica, sans-serif">Greenplum Database 3.3 SQL Reference</font></strong></p>
        </td>
      </tr>
	  <tr> 
        <td>
          <p><font size="1" face="Arial, Helvetica, sans-serif">Last Updated: February 17, 2009</font></p>
        </td>
      </tr>
    </table>
      
  </body>
</html>
